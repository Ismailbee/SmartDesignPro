# ğŸ—ï¸ Paystack Payment System Architecture

## **Complete System Overview**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PAYSTACK LIVE SYSTEM                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      FRONTEND (Vue 3 + Ionic)                    â”‚  â”‚
â”‚  â”‚                    http://localhost:8101                         â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  index.html                                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Paystack Script: https://js.paystack.co/v1/inline.js  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Vue App                                                â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  .env (Frontend Variables)                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ VITE_PAYSTACK_PUBLIC_KEY=pk_live_...                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ VITE_PAYMENT_API_URL=http://localhost:3006           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ VITE_FIREBASE_* (Firebase config)                    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  src/services/payment.service.ts                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ initializePayment()                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ openPaystackPopup()                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ purchaseTokens()                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ verifyPayment()                                        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  src/views/TokensAndPlans.vue                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Token Purchase UI                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Plan Upgrade UI                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Payment History                                        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  src/stores/user.store.ts (Pinia)                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ user.tokens                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ user.plan                                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ user.planExpiryDate                                    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚                              â†“ HTTP/HTTPS â†“                             â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  BACKEND (Node.js + Express)                     â”‚  â”‚
â”‚  â”‚                    http://localhost:3006                         â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  .env (Backend Variables)                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ PAYSTACK_SECRET_KEY=sk_live_...                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ PAYSTACK_PUBLIC_KEY=pk_live_...                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ PAYSTACK_WEBHOOK_SECRET=whsec_...                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ PAYMENT_PORT=3006                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ NODE_ENV=production                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ CORS_ORIGINS=http://localhost:8101                    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  payment-server.cjs                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ require('dotenv').config()                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Express Server                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ CORS Middleware                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Error Handling                                         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  API Endpoints                                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ POST /api/payments/initialize                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ POST /api/payments/verify                              â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ POST /api/payments/webhook                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ GET /api/users/:userId                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ POST /api/users/:userId/tokens                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ GET /health                                            â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Paystack Service                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ initializeTransaction()                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ verifyTransaction()                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ verifyWebhookSignature()                               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  SQLite Database (payments.db)                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ users table                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ id, email, name                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ tokens, plan, planExpiryDate                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ totalDesignsGenerated                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ payments table                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ id, userId, amount, type                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ reference, status, tokens                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ plan, planId, metadata, createdAt                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚                              â†“ HTTPS â†“                                  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    PAYSTACK LIVE API                             â”‚  â”‚
â”‚  â”‚                  https://api.paystack.co                         â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Paystack Endpoints                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ POST /transaction/initialize                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ GET /transaction/verify/:reference                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Webhook: charge.success, charge.failed                 â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Paystack Dashboard                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ https://dashboard.paystack.com                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Transactions View                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Settings â†’ Developer                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Webhook Configuration                                  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **Data Flow: Token Purchase**

```
1. USER INITIATES PURCHASE
   â†“
   Frontend: Click "Buy Now" button
   â†“
   
2. INITIALIZE PAYMENT
   â†“
   Frontend: POST /api/payments/initialize
   â”œâ”€ userId, email, amount, tokens
   â”œâ”€ type: "token_purchase"
   â””â”€ metadata
   â†“
   Backend: Create payment record (status: pending)
   â”œâ”€ Generate unique reference
   â”œâ”€ Call Paystack API
   â””â”€ Return authorization_url
   â†“
   
3. OPEN PAYSTACK POPUP
   â†“
   Frontend: PaystackPop.setup()
   â”œâ”€ key: VITE_PAYSTACK_PUBLIC_KEY
   â”œâ”€ email, amount, reference
   â””â”€ metadata
   â†“
   User: Enter payment details
   â†“
   
4. PROCESS PAYMENT
   â†“
   Paystack: Process transaction
   â”œâ”€ Validate card
   â”œâ”€ Charge customer
   â””â”€ Return response
   â†“
   
5. VERIFY PAYMENT
   â†“
   Frontend: verifyPayment(reference)
   â”œâ”€ POST /api/payments/verify
   â””â”€ reference
   â†“
   Backend: Query Paystack API
   â”œâ”€ GET /transaction/verify/:reference
   â”œâ”€ Check status: "success"
   â””â”€ Update payment record
   â†“
   
6. UPDATE USER TOKENS
   â†“
   Backend: Update user record
   â”œâ”€ Add tokens to balance
   â”œâ”€ Update totalDesignsGenerated
   â””â”€ Return updated user
   â†“
   Frontend: Update Pinia store
   â”œâ”€ userStore.user.tokens += amount
   â””â”€ Show success toast
   â†“
   
7. WEBHOOK CONFIRMATION
   â†“
   Paystack: Send webhook
   â”œâ”€ Event: charge.success
   â”œâ”€ Reference, amount, status
   â””â”€ Signature
   â†“
   Backend: Receive webhook
   â”œâ”€ Verify signature
   â”œâ”€ Verify payment
   â”œâ”€ Update database
   â””â”€ Send 200 OK
   â†“
   
8. COMPLETE
   â†“
   User: Tokens added to account âœ…
```

---

## **Security Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY ARCHITECTURE                        â”‚
â”‚                                                                 â”‚
â”‚  FRONTEND (Client-Side)                                         â”‚
â”‚  â”œâ”€ VITE_PAYSTACK_PUBLIC_KEY (Safe to expose)                  â”‚
â”‚  â”œâ”€ VITE_PAYMENT_API_URL (Safe to expose)                      â”‚
â”‚  â””â”€ NO SECRET KEYS                                              â”‚
â”‚                                                                 â”‚
â”‚  â†“ HTTPS Only â†“                                                 â”‚
â”‚                                                                 â”‚
â”‚  BACKEND (Server-Side)                                          â”‚
â”‚  â”œâ”€ PAYSTACK_SECRET_KEY (Never exposed)                        â”‚
â”‚  â”œâ”€ PAYSTACK_WEBHOOK_SECRET (Never exposed)                    â”‚
â”‚  â”œâ”€ SESSION_SECRET (Never exposed)                             â”‚
â”‚  â””â”€ All keys in .env (Not in Git)                              â”‚
â”‚                                                                 â”‚
â”‚  â†“ HTTPS Only â†“                                                 â”‚
â”‚                                                                 â”‚
â”‚  PAYSTACK API (Secure)                                          â”‚
â”‚  â”œâ”€ Authorization: Bearer PAYSTACK_SECRET_KEY                  â”‚
â”‚  â”œâ”€ HTTPS Only                                                  â”‚
â”‚  â””â”€ Webhook Signature Verification                              â”‚
â”‚                                                                 â”‚
â”‚  â†“ HTTPS Only â†“                                                 â”‚
â”‚                                                                 â”‚
â”‚  DATABASE (SQLite)                                              â”‚
â”‚  â”œâ”€ File permissions: 600                                       â”‚
â”‚  â”œâ”€ Encrypted at rest (optional)                                â”‚
â”‚  â””â”€ Regular backups                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## **Environment Variables Structure**

```
.env (Root Directory)
â”‚
â”œâ”€ FIREBASE CONFIGURATION
â”‚  â”œâ”€ VITE_FIREBASE_API_KEY
â”‚  â”œâ”€ VITE_FIREBASE_AUTH_DOMAIN
â”‚  â”œâ”€ VITE_FIREBASE_PROJECT_ID
â”‚  â”œâ”€ VITE_FIREBASE_STORAGE_BUCKET
â”‚  â”œâ”€ VITE_FIREBASE_MESSAGING_SENDER_ID
â”‚  â”œâ”€ VITE_FIREBASE_APP_ID
â”‚  â””â”€ VITE_FIREBASE_MEASUREMENT_ID
â”‚
â”œâ”€ PAYSTACK LIVE API KEYS
â”‚  â”œâ”€ PAYSTACK_SECRET_KEY (Backend only)
â”‚  â”œâ”€ PAYSTACK_PUBLIC_KEY (Backend reference)
â”‚  â”œâ”€ VITE_PAYSTACK_PUBLIC_KEY (Frontend)
â”‚  â””â”€ PAYSTACK_WEBHOOK_SECRET (Backend only)
â”‚
â”œâ”€ PAYMENT API CONFIGURATION
â”‚  â”œâ”€ VITE_PAYMENT_API_URL (Frontend)
â”‚  â”œâ”€ PAYMENT_PORT (Backend)
â”‚  â””â”€ NODE_ENV (Backend)
â”‚
â”œâ”€ SECURITY SETTINGS
â”‚  â”œâ”€ CORS_ORIGINS (Backend)
â”‚  â””â”€ SESSION_SECRET (Backend)
â”‚
â”œâ”€ DATABASE CONFIGURATION
â”‚  â””â”€ DB_PATH (Backend)
â”‚
â””â”€ WEBHOOK CONFIGURATION
   â”œâ”€ WEBHOOK_URL (Backend)
   â””â”€ PAYSTACK_WEBHOOK_SECRET (Backend)
```

---

## **Deployment Architecture**

```
PRODUCTION ENVIRONMENT
â”‚
â”œâ”€ HTTPS Load Balancer
â”‚  â”œâ”€ SSL Certificate (Let's Encrypt)
â”‚  â””â”€ Redirect HTTP â†’ HTTPS
â”‚
â”œâ”€ Nginx Reverse Proxy
â”‚  â”œâ”€ Frontend: Serve static files
â”‚  â”œâ”€ Backend: Proxy to Node.js
â”‚  â””â”€ SSL Termination
â”‚
â”œâ”€ Node.js Payment Server (PM2)
â”‚  â”œâ”€ Process Manager: PM2
â”‚  â”œâ”€ Auto-restart on crash
â”‚  â”œâ”€ Load balancing (multiple instances)
â”‚  â””â”€ Log rotation
â”‚
â”œâ”€ SQLite Database
â”‚  â”œâ”€ Regular backups
â”‚  â”œâ”€ File permissions: 600
â”‚  â””â”€ Monitoring
â”‚
â””â”€ Monitoring & Logging
   â”œâ”€ PM2 logs
   â”œâ”€ Paystack dashboard
   â”œâ”€ Email alerts
   â””â”€ Error tracking
```

---

## **Key Security Points**

```
âœ… FRONTEND
   â”œâ”€ Public key only (pk_live_...)
   â”œâ”€ No secret keys
   â”œâ”€ HTTPS only
   â””â”€ Paystack script from CDN

âœ… BACKEND
   â”œâ”€ Secret key in .env
   â”œâ”€ .env in .gitignore
   â”œâ”€ Webhook signature verification
   â”œâ”€ HTTPS only
   â””â”€ CORS restricted

âœ… DATABASE
   â”œâ”€ SQLite (file-based)
   â”œâ”€ Proper file permissions
   â”œâ”€ Regular backups
   â””â”€ No sensitive data in logs

âœ… PAYSTACK
   â”œâ”€ LIVE API keys
   â”œâ”€ Webhook secret verification
   â”œâ”€ HTTPS communication
   â””â”€ PCI compliance
```

---

**This architecture ensures secure, scalable payment processing with Paystack LIVE API!** ğŸš€

