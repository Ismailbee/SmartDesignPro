<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Name Extraction & Font Sizing Debug</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .input-section {
      background: white;
      padding: 30px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      resize: vertical;
      min-height: 100px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 15px;
    }

    button:hover {
      background: #764ba2;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .results {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .results h2 {
      color: #667eea;
      margin-bottom: 20px;
    }

    .step {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #667eea;
    }

    .step-title {
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .step-content {
      font-family: 'Courier New', monospace;
      background: white;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .name-result {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .name-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #e0e0e0;
    }

    .name-card.has-reduction {
      border-color: #ff9800;
      background: #fff3e0;
    }

    .name-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .name-value {
      font-family: 'Times New Roman', serif;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }

    .metrics {
      font-size: 13px;
      color: #666;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîç Name Extraction & Font Sizing Debug Tool</h1>
      <p style="color: #666; margin-top: 10px;">Test the complete flow: Description ‚Üí Name Extraction ‚Üí Font Size Calculation</p>
    </div>

    <div class="input-section">
      <h2 style="margin-bottom: 15px; color: #333;">Enter Description with Names in Parentheses</h2>
      <textarea id="description" placeholder="Example: Congratulations on your wedding (Suleiman ABDULLAHI & Ramatu YUNUSA)">Congratulations on your wedding (Suleiman ABDULLAHI & Ramatu YUNUSA)</textarea>
      <button onclick="testExtraction()">üîç Extract & Calculate</button>
    </div>

    <div id="results"></div>
  </div>

  <script>
    // Exact copy of extractNamesFromBrackets from useWeddingStickerUpdater.ts
    function extractNamesFromBrackets(description) {
      const bracketPattern = /[\(\[]([^\)\]]+)[\)\]]/
      const match = description.match(bracketPattern)

      if (match && match[1]) {
        const namesText = match[1].trim()

        // Try to split by "and" or "&" to get couples
        const couplePattern = /([^&]+)\s*(?:&|and)\s*([^&]+)/i
        const coupleMatch = namesText.match(couplePattern)

        if (coupleMatch) {
          // We have two people
          const person1 = coupleMatch[1].trim()
          const person2 = coupleMatch[2].trim()

          // Parse person 1 (first token = first name, last token = last name)
          const person1Parts = person1.split(/\s+/).filter(w => w.length > 0)
          const first1 = person1Parts.length > 0 ? person1Parts[0] : null
          const last1 = person1Parts.length > 1 ? person1Parts[person1Parts.length - 1] : null

          // Parse person 2 (first token = first name, last token = last name)
          const person2Parts = person2.split(/\s+/).filter(w => w.length > 0)
          const first2 = person2Parts.length > 0 ? person2Parts[0] : null
          const last2 = person2Parts.length > 1 ? person2Parts[person2Parts.length - 1] : null

          // For backward compatibility, combine first + last for name1 and name2
          const fullName1 = [first1, last1].filter(Boolean).join(' ').toUpperCase()
          const fullName2 = [first2, last2].filter(Boolean).join(' ').toUpperCase()

          return {
            name1: fullName1 || null,
            name2: fullName2 || null,
            name1First: first1 ? first1.toUpperCase() : null,
            name1Last: last1 ? last1.toUpperCase() : null,
            name2First: first2 ? first2.toUpperCase() : null,
            name2Last: last2 ? last2.toUpperCase() : null
          }
        }

        // Single person or simple format
        const words = namesText.split(/\s+/).filter(w => w.length > 0)
        if (words.length >= 2) {
          const firstName = words[0]
          const lastName = words[words.length - 1]
          const fullName = words.join(' ').toUpperCase()

          return {
            name1: fullName,
            name2: null,
            name1First: firstName.toUpperCase(),
            name1Last: lastName.toUpperCase(),
            name2First: null,
            name2Last: null
          }
        } else if (words.length === 1) {
          return {
            name1: words[0].toUpperCase(),
            name2: null,
            name1First: words[0].toUpperCase(),
            name1Last: null,
            name2First: null,
            name2Last: null
          }
        }
      }

      return { 
        name1: null, 
        name2: null,
        name1First: null,
        name1Last: null,
        name2First: null,
        name2Last: null
      }
    }

    // Exact copy of calculateNameFontSize from useWeddingStickerUpdater.ts
    function calculateNameFontSize(text, baseFontSize) {
      const letterCount = text.replace(/[^a-zA-Z]/g, '').length
      
      if (letterCount <= 9) {
        return baseFontSize
      } else {
        const scaleFactor = 9 / letterCount
        return baseFontSize * scaleFactor
      }
    }

    function testExtraction() {
      const description = document.getElementById('description').value
      const extracted = extractNamesFromBrackets(description)

      let html = '<div class="results">'
      html += '<h2>üìä Extraction & Calculation Results</h2>'

      // Step 1: Show extraction
      html += '<div class="step">'
      html += '<div class="step-title">Step 1: Name Extraction from Parentheses</div>'
      html += '<div class="step-content">'
      html += `Input: "${description}"\n\n`
      html += `Extracted Data:\n`
      html += `  name1: ${extracted.name1 || 'null'}\n`
      html += `  name2: ${extracted.name2 || 'null'}\n`
      html += `  name1First: ${extracted.name1First || 'null'}\n`
      html += `  name1Last: ${extracted.name1Last || 'null'}\n`
      html += `  name2First: ${extracted.name2First || 'null'}\n`
      html += `  name2Last: ${extracted.name2Last || 'null'}`
      html += '</div>'
      html += '</div>'

      // Step 2: Calculate font sizes
      const calculations = []
      
      if (extracted.name1First) {
        const fontSize = calculateNameFontSize(extracted.name1First, 68.31)
        const letterCount = extracted.name1First.replace(/[^a-zA-Z]/g, '').length
        calculations.push({
          label: 'Person 1 - First Name',
          name: extracted.name1First,
          baseSize: 68.31,
          fontSize: fontSize,
          letterCount: letterCount,
          reduced: letterCount > 9
        })
      }

      if (extracted.name1Last) {
        const fontSize = calculateNameFontSize(extracted.name1Last, 28.06)
        const letterCount = extracted.name1Last.replace(/[^a-zA-Z]/g, '').length
        calculations.push({
          label: 'Person 1 - Last Name',
          name: extracted.name1Last,
          baseSize: 28.06,
          fontSize: fontSize,
          letterCount: letterCount,
          reduced: letterCount > 9
        })
      }

      if (extracted.name2First) {
        const fontSize = calculateNameFontSize(extracted.name2First, 68.31)
        const letterCount = extracted.name2First.replace(/[^a-zA-Z]/g, '').length
        calculations.push({
          label: 'Person 2 - First Name',
          name: extracted.name2First,
          baseSize: 68.31,
          fontSize: fontSize,
          letterCount: letterCount,
          reduced: letterCount > 9
        })
      }

      if (extracted.name2Last) {
        const fontSize = calculateNameFontSize(extracted.name2Last, 28.06)
        const letterCount = extracted.name2Last.replace(/[^a-zA-Z]/g, '').length
        calculations.push({
          label: 'Person 2 - Last Name',
          name: extracted.name2Last,
          baseSize: 28.06,
          fontSize: fontSize,
          letterCount: letterCount,
          reduced: letterCount > 9
        })
      }

      html += '<div class="step">'
      html += '<div class="step-title">Step 2: Font Size Calculations</div>'
      html += '<div class="name-result">'

      calculations.forEach(calc => {
        const percentage = ((calc.fontSize / calc.baseSize) * 100).toFixed(1)
        html += `
          <div class="name-card ${calc.reduced ? 'has-reduction' : ''}">
            <div class="name-label">${calc.label}</div>
            <div class="name-value" style="font-size: ${calc.fontSize * 0.3}px;">${calc.name}</div>
            <div class="metrics">
              <div class="metric-row">
                <span>Letter Count:</span>
                <strong>${calc.letterCount}</strong>
              </div>
              <div class="metric-row">
                <span>Base Size:</span>
                <strong>${calc.baseSize}px</strong>
              </div>
              <div class="metric-row">
                <span>Calculated Size:</span>
                <strong style="color: ${calc.reduced ? '#ff9800' : '#4caf50'};">${calc.fontSize.toFixed(2)}px</strong>
              </div>
              <div class="metric-row">
                <span>Percentage:</span>
                <strong>${percentage}%</strong>
              </div>
              ${calc.reduced ? `
                <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 4px; font-size: 11px;">
                  Formula: ${calc.baseSize} √ó (9 / ${calc.letterCount}) = ${calc.fontSize.toFixed(2)}px
                </div>
              ` : ''}
            </div>
          </div>
        `
      })

      html += '</div>'
      html += '</div>'

      // Summary
      const hasReduction = calculations.some(c => c.reduced)
      if (hasReduction) {
        html += '<div class="warning">'
        html += '<strong>‚ö†Ô∏è Font Size Reduction Applied</strong><br>'
        html += 'One or more names have 10+ letters and will be displayed with reduced font size.'
        html += '</div>'
      } else {
        html += '<div class="success">'
        html += '<strong>‚úÖ No Font Size Reduction Needed</strong><br>'
        html += 'All names have 9 or fewer letters and will use the original font size.'
        html += '</div>'
      }

      html += '</div>'

      document.getElementById('results').innerHTML = html
    }

    // Run on page load
    testExtraction()
  </script>
</body>
</html>

