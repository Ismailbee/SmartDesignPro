<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Debug Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 24px;
    }

    .section {
      margin-bottom: 24px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .section h2 {
      color: #667eea;
      margin-bottom: 16px;
      font-size: 18px;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin: 4px;
      transition: all 0.3s ease;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .console {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 16px;
    }

    .log {
      margin: 4px 0;
      line-height: 1.5;
    }

    .log.success { color: #4ec9b0; }
    .log.error { color: #f48771; }
    .log.warning { color: #dcdcaa; }
    .log.info { color: #9cdcfe; }

    .status {
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      font-size: 14px;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 12px;
    }

    input:focus {
      outline: none;
      border-color: #667eea;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Login Debug Tool</h1>

    <div class="section">
      <h2>Step 1: Check Environment Variables</h2>
      <button onclick="checkEnv()">Check Firebase Config</button>
      <div id="envStatus"></div>
    </div>

    <div class="section">
      <h2>Step 2: Test Firebase Connection</h2>
      <button onclick="testFirebase()">Test Firebase</button>
      <div id="firebaseStatus"></div>
    </div>

    <div class="section">
      <h2>Step 3: Check Auth Store</h2>
      <button onclick="checkAuthStore()">Check Auth Store</button>
      <div id="authStatus"></div>
    </div>

    <div class="section">
      <h2>Step 4: Test Login</h2>
      <input type="email" id="email" placeholder="Email" value="test@example.com">
      <input type="password" id="password" placeholder="Password" value="password123">
      <button onclick="testLogin()">Test Login</button>
      <div id="loginStatus"></div>
    </div>

    <div class="section">
      <h2>Step 5: Clear All Data</h2>
      <button onclick="clearAll()">Clear Everything & Reload</button>
    </div>

    <div class="console" id="console">
      <div class="log info">Console output will appear here...</div>
    </div>
  </div>

  <script type="module">
    window.log = function(message, type = 'info') {
      const consoleEl = document.getElementById('console')
      const line = document.createElement('div')
      line.className = `log ${type}`
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`
      consoleEl.appendChild(line)
      consoleEl.scrollTop = consoleEl.scrollHeight
      console.log(message)
    }

    window.showStatus = function(elementId, message, type = 'info') {
      const el = document.getElementById(elementId)
      el.innerHTML = `<div class="status ${type}">${message}</div>`
    }

    window.checkEnv = function() {
      log('üîç Checking environment variables...', 'info')
      
      const vars = {
        'VITE_FIREBASE_API_KEY': import.meta.env.VITE_FIREBASE_API_KEY,
        'VITE_FIREBASE_AUTH_DOMAIN': import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
        'VITE_FIREBASE_PROJECT_ID': import.meta.env.VITE_FIREBASE_PROJECT_ID,
        'VITE_FIREBASE_STORAGE_BUCKET': import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
        'VITE_FIREBASE_MESSAGING_SENDER_ID': import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
        'VITE_FIREBASE_APP_ID': import.meta.env.VITE_FIREBASE_APP_ID
      }

      let allPresent = true
      let html = '<ul style="margin: 8px 0; padding-left: 20px;">'
      
      Object.entries(vars).forEach(([key, value]) => {
        const status = value ? '‚úÖ' : '‚ùå'
        const display = value ? (value.substring(0, 20) + '...') : 'MISSING'
        html += `<li>${status} ${key}: ${display}</li>`
        log(`${status} ${key}: ${value ? 'Present' : 'MISSING'}`, value ? 'success' : 'error')
        if (!value) allPresent = false
      })
      
      html += '</ul>'
      
      if (allPresent) {
        showStatus('envStatus', '‚úÖ All environment variables are loaded!' + html, 'success')
      } else {
        showStatus('envStatus', '‚ùå Some environment variables are missing!' + html + '<br><strong>Solution:</strong> Restart the dev server with: ionic serve', 'error')
      }
    }

    window.testFirebase = async function() {
      log('üî• Testing Firebase initialization...', 'info')
      
      try {
        const firebaseModule = await import('/src/config/firebase.ts')
        log('‚úÖ Firebase module loaded', 'success')
        
        if (firebaseModule.auth) {
          log('‚úÖ Firebase Auth initialized', 'success')
        } else {
          log('‚ùå Firebase Auth not found', 'error')
        }
        
        if (firebaseModule.db) {
          log('‚úÖ Firestore initialized', 'success')
        } else {
          log('‚ùå Firestore not found', 'error')
        }
        
        if (firebaseModule.storage) {
          log('‚úÖ Firebase Storage initialized', 'success')
        } else {
          log('‚ùå Firebase Storage not found', 'error')
        }
        
        showStatus('firebaseStatus', '‚úÖ Firebase is initialized correctly!', 'success')
      } catch (error) {
        log('‚ùå Firebase initialization failed: ' + error.message, 'error')
        showStatus('firebaseStatus', '‚ùå Firebase initialization failed!<br>' + error.message, 'error')
      }
    }

    window.checkAuthStore = async function() {
      log('üîê Checking auth store...', 'info')
      
      try {
        const authModule = await import('/src/stores/auth.ts')
        const { useAuthStore } = authModule
        const authStore = useAuthStore()
        
        log('‚úÖ Auth store loaded', 'success')
        log(`Is Authenticated: ${authStore.isAuthenticated}`, 'info')
        log(`User: ${authStore.user ? authStore.user.email : 'null'}`, 'info')
        log(`Modal Open: ${authStore.isAuthModalOpen}`, 'info')
        
        const html = `
          <ul style="margin: 8px 0; padding-left: 20px;">
            <li>Authenticated: ${authStore.isAuthenticated ? '‚úÖ Yes' : '‚ùå No'}</li>
            <li>User: ${authStore.user ? authStore.user.email : 'None'}</li>
            <li>Modal Open: ${authStore.isAuthModalOpen ? 'Yes' : 'No'}</li>
          </ul>
        `
        
        showStatus('authStatus', '‚úÖ Auth store is working!' + html, 'success')
      } catch (error) {
        log('‚ùå Auth store check failed: ' + error.message, 'error')
        showStatus('authStatus', '‚ùå Auth store check failed!<br>' + error.message, 'error')
      }
    }

    window.testLogin = async function() {
      const email = document.getElementById('email').value
      const password = document.getElementById('password').value
      
      log('üîê Testing login...', 'info')
      log(`Email: ${email}`, 'info')
      
      try {
        const authModule = await import('/src/stores/auth.ts')
        const { useAuthStore } = authModule
        const authStore = useAuthStore()
        
        log('Calling loginUser...', 'info')
        
        await authStore.loginUser({ email, password, rememberMe: false })
        
        log('‚úÖ Login successful!', 'success')
        log(`User: ${authStore.user?.email}`, 'success')
        
        showStatus('loginStatus', '‚úÖ Login successful!<br>User: ' + authStore.user?.email, 'success')
      } catch (error) {
        log('‚ùå Login failed: ' + error.message, 'error')
        console.error('Full error:', error)
        showStatus('loginStatus', '‚ùå Login failed!<br>' + error.message, 'error')
      }
    }

    window.clearAll = function() {
      log('üßπ Clearing all data...', 'warning')
      localStorage.clear()
      sessionStorage.clear()
      log('‚úÖ All data cleared', 'success')
      log('üîÑ Reloading in 2 seconds...', 'info')
      setTimeout(() => location.reload(), 2000)
    }

    // Auto-run environment check on load
    window.addEventListener('load', () => {
      setTimeout(() => {
        log('üëã Welcome to Login Debug Tool', 'info')
        log('Click "Check Firebase Config" to start', 'info')
      }, 500)
    })
  </script>
</body>
</html>

