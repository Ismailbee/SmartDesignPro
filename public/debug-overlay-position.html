<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Overlay Position Debugger</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    .debug-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      color: #333;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
    }
    .instruction {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    .code-block {
      background: #263238;
      color: #aed581;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
      margin: 10px 0;
    }
    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    .error {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .result {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 15px;
      border-radius: 4px;
      margin: 10px 0;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .step {
      background: white;
      border: 2px solid #007bff;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
    }
    .step-number {
      display: inline-block;
      background: #007bff;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="debug-panel">
    <h2>üîç Text Overlay Position Debugger</h2>
    <p>This tool will help you diagnose why the text overlay is not positioned correctly.</p>
  </div>

  <div class="step">
    <h3><span class="step-number">1</span>Open Your Application</h3>
    <div class="instruction">
      <p><strong>Action:</strong> Open your WhiteboardCanvas application in a new tab</p>
      <button onclick="window.open('http://localhost:5173/', '_blank')">Open App in New Tab</button>
    </div>
  </div>

  <div class="step">
    <h3><span class="step-number">2</span>Add Text and Open Console</h3>
    <div class="instruction">
      <ol>
        <li>In the app, click the <strong>"Add Text"</strong> button in the sidebar</li>
        <li>Press <strong>F12</strong> to open the browser console</li>
        <li>Look for log messages starting with üîç or üé®</li>
      </ol>
    </div>
  </div>

  <div class="step">
    <h3><span class="step-number">3</span>Run Diagnostic Script</h3>
    <div class="instruction">
      <p><strong>Action:</strong> Copy and paste this script into the browser console while the text overlay is visible:</p>
      <div class="code-block">// DIAGNOSTIC SCRIPT - Copy and paste into console
(function() {
  console.log('=== OVERLAY POSITION DIAGNOSTIC ===');
  
  // 1. Find the overlay element
  const overlay = document.querySelector('.text-edit-overlay');
  if (!overlay) {
    console.error('‚ùå Overlay element not found! Is text editing active?');
    return;
  }
  console.log('‚úÖ Overlay element found');
  
  // 2. Get overlay computed styles
  const overlayRect = overlay.getBoundingClientRect();
  const overlayStyles = window.getComputedStyle(overlay);
  
  console.log('\nüìê OVERLAY DIMENSIONS:');
  console.log({
    position: overlayStyles.position,
    left: overlayStyles.left,
    top: overlayStyles.top,
    width: overlayStyles.width,
    height: overlayStyles.height,
    transform: overlayStyles.transform,
    transformOrigin: overlayStyles.transformOrigin
  });
  
  console.log('\nüìç OVERLAY BOUNDING RECT:');
  console.log({
    left: overlayRect.left + 'px',
    top: overlayRect.top + 'px',
    width: overlayRect.width + 'px',
    height: overlayRect.height + 'px',
    right: overlayRect.right + 'px',
    bottom: overlayRect.bottom + 'px'
  });
  
  // 3. Find the canvas and text
  const canvas = document.querySelector('canvas');
  if (!canvas) {
    console.error('‚ùå Canvas not found!');
    return;
  }
  console.log('‚úÖ Canvas found');
  
  const canvasRect = canvas.getBoundingClientRect();
  console.log('\nüé® CANVAS POSITION:');
  console.log({
    left: canvasRect.left + 'px',
    top: canvasRect.top + 'px',
    width: canvasRect.width + 'px',
    height: canvasRect.height + 'px'
  });
  
  // 4. Calculate offset
  const offsetX = overlayRect.left - canvasRect.left;
  const offsetY = overlayRect.top - canvasRect.top;
  
  console.log('\nüìè OVERLAY OFFSET FROM CANVAS:');
  console.log({
    offsetX: offsetX + 'px',
    offsetY: offsetY + 'px'
  });
  
  // 5. Check for issues
  console.log('\nüîç DIAGNOSTIC RESULTS:');
  
  const issues = [];
  
  if (overlayStyles.position !== 'fixed') {
    issues.push('‚ùå Position is not "fixed" (found: ' + overlayStyles.position + ')');
  } else {
    console.log('‚úÖ Position is "fixed"');
  }
  
  if (overlayStyles.left === 'auto' || overlayStyles.left === '0px') {
    issues.push('‚ö†Ô∏è Left position seems wrong: ' + overlayStyles.left);
  } else {
    console.log('‚úÖ Left position is set: ' + overlayStyles.left);
  }
  
  if (overlayStyles.top === 'auto' || overlayStyles.top === '0px') {
    issues.push('‚ö†Ô∏è Top position seems wrong: ' + overlayStyles.top);
  } else {
    console.log('‚úÖ Top position is set: ' + overlayStyles.top);
  }
  
  const width = parseFloat(overlayStyles.width);
  if (isNaN(width) || width < 10) {
    issues.push('‚ùå Width is too small or invalid: ' + overlayStyles.width);
  } else if (width > 1000) {
    issues.push('‚ö†Ô∏è Width seems too large: ' + overlayStyles.width);
  } else {
    console.log('‚úÖ Width looks reasonable: ' + overlayStyles.width);
  }
  
  const height = parseFloat(overlayStyles.height);
  if (isNaN(height) || height < 10) {
    issues.push('‚ùå Height is too small or invalid: ' + overlayStyles.height);
  } else if (height > 500) {
    issues.push('‚ö†Ô∏è Height seems too large: ' + overlayStyles.height);
  } else {
    console.log('‚úÖ Height looks reasonable: ' + overlayStyles.height);
  }
  
  if (issues.length > 0) {
    console.log('\n‚ö†Ô∏è ISSUES FOUND:');
    issues.forEach(issue => console.log(issue));
  } else {
    console.log('\n‚úÖ No obvious issues found with overlay styles');
  }
  
  // 6. Visual indicator
  console.log('\nüí° TIP: The overlay should appear inside the canvas area.');
  console.log('If offsetX and offsetY are very large or negative, the overlay is mispositioned.');
  
  return {
    overlay: {
      position: overlayStyles.position,
      left: overlayStyles.left,
      top: overlayStyles.top,
      width: overlayStyles.width,
      height: overlayStyles.height,
      actualRect: overlayRect
    },
    canvas: {
      rect: canvasRect
    },
    offset: {
      x: offsetX,
      y: offsetY
    },
    issues: issues
  };
})();</div>
      <button onclick="copyDiagnosticScript()">Copy Script to Clipboard</button>
    </div>
  </div>

  <div class="step">
    <h3><span class="step-number">4</span>Check Console Logs</h3>
    <div class="instruction">
      <p>Look for these specific log messages in the console:</p>
      <ul>
        <li><code>üîç alignTextareaToKonva - Dimensions:</code> - Shows text dimensions</li>
        <li><code>üîç alignTextareaToKonva - Final dimensions:</code> - Shows calculated overlay size</li>
        <li><code>üé® Applied styles:</code> - Shows CSS styles applied to overlay</li>
      </ul>
      <p><strong>Copy and paste ALL console output here or share a screenshot.</strong></p>
    </div>
  </div>

  <div class="step">
    <h3><span class="step-number">5</span>Visual Check</h3>
    <div class="warning">
      <p><strong>Describe what you see:</strong></p>
      <ul>
        <li>Where is the text on the canvas? (e.g., "center", "top-left", "bottom-right")</li>
        <li>Where is the blue overlay box? (e.g., "far left", "top of screen", "off-screen")</li>
        <li>Is the overlay visible at all?</li>
        <li>Is the overlay the right size or is it very narrow/tall?</li>
      </ul>
    </div>
  </div>

  <div class="debug-panel">
    <h2>üìã Common Issues and Solutions</h2>
    
    <div class="error">
      <h4>Issue: Overlay appears as a vertical strip</h4>
      <p><strong>Cause:</strong> Width is very small (like 10-20px) or width/height are swapped</p>
      <p><strong>Check:</strong> Console log should show <code>finalWidth</code> and <code>finalHeight</code> values</p>
    </div>
    
    <div class="error">
      <h4>Issue: Overlay appears at top-left of screen</h4>
      <p><strong>Cause:</strong> <code>left</code> and <code>top</code> are 0 or not being calculated correctly</p>
      <p><strong>Check:</strong> Console log should show <code>viewportX</code> and <code>viewportY</code> values</p>
    </div>
    
    <div class="error">
      <h4>Issue: Overlay is completely off-screen</h4>
      <p><strong>Cause:</strong> Position calculation is using wrong coordinate system</p>
      <p><strong>Check:</strong> <code>position</code> should be "fixed", not "absolute"</p>
    </div>
    
    <div class="error">
      <h4>Issue: textWidth or textHeight is 0 or undefined</h4>
      <p><strong>Cause:</strong> Text node hasn't rendered yet or getWidth()/getHeight() not working</p>
      <p><strong>Solution:</strong> May need to wait for Konva to render before calling alignment function</p>
    </div>
  </div>

  <script>
    function copyDiagnosticScript() {
      const script = document.querySelector('.code-block').textContent;
      navigator.clipboard.writeText(script).then(() => {
        alert('‚úÖ Diagnostic script copied to clipboard!\n\nNow:\n1. Go to your app\n2. Press F12 to open console\n3. Paste and press Enter');
      });
    }
  </script>
</body>
</html>

