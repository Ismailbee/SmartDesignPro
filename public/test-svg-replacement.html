<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Replacement Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        #svg-container {
            border: 2px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            background: #f5f5f5;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
        }
        .success { background: #90EE90; }
        .error { background: #FFB6C1; }
        .info { background: #87CEEB; }
        #log {
            background: #000;
            color: #0F0;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üß™ SVG Replacement Test</h1>
    <p>This tests if the SVG replacement logic works correctly outside of the Vue app.</p>
    
    <div>
        <button onclick="loadTemplate()">1. Load Template</button>
        <button onclick="replaceCongrat()">2. Replace with congrat.svg</button>
        <button onclick="replaceNikkah()">3. Replace with Nikkah.svg</button>
        <button onclick="restoreOriginal()">4. Restore Original</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div id="svg-container"></div>
    <div id="log"></div>
    
    <script>
        const log = (msg, type = 'info') => {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#FF6B6B' : type === 'success' ? '#51CF66' : '#74C0FC';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        };
        
        const clearLog = () => {
            document.getElementById('log').innerHTML = '';
        };
        
        let originalElements = new Map();
        
        async function loadTemplate() {
            try {
                log('üì• Loading wedding template...', 'info');
                const response = await fetch('/svg/weddingStiker/template');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const svgText = await response.text();
                document.getElementById('svg-container').innerHTML = svgText;
                log('‚úÖ Template loaded successfully', 'success');
                
                // Store original elements
                const svgElement = document.querySelector('#svg-container svg');
                ['blessing-text', 'occasion-text', 'event-type-text', 'ceremony-text'].forEach(id => {
                    const element = svgElement.querySelector(`#${id}`);
                    if (element) {
                        originalElements.set(id, {
                            element: element.cloneNode(true),
                            parent: element.parentElement
                        });
                        log(`üíæ Stored original: #${id}`, 'info');
                    }
                });
            } catch (error) {
                log(`‚ùå Error loading template: ${error.message}`, 'error');
            }
        }
        
        async function replaceWithSVG(path, name) {
            try {
                log(`üé® Fetching ${name} from: ${path}`, 'info');
                const response = await fetch(path);
                if (!response.ok) {
                    log(`‚ùå Fetch failed: ${response.status} ${response.statusText}`, 'error');
                    return;
                }
                
                const svgText = await response.text();
                log(`‚úÖ Fetched ${svgText.length} bytes`, 'success');
                log(`üìÑ First 100 chars: ${svgText.substring(0, 100)}`, 'info');
                
                // Parse SVG
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgText, 'image/svg+xml');
                const parserError = svgDoc.querySelector('parsererror');
                if (parserError) {
                    log(`‚ùå XML parsing error: ${parserError.textContent}`, 'error');
                    return;
                }
                
                const fetchedSvg = svgDoc.querySelector('svg');
                if (!fetchedSvg) {
                    log('‚ùå No <svg> element found in response', 'error');
                    log(`üìÑ Document body: ${svgDoc.documentElement?.outerHTML?.substring(0, 200)}`, 'error');
                    return;
                }
                
                log('‚úÖ SVG parsed successfully', 'success');
                
                // Get main SVG
                const svgElement = document.querySelector('#svg-container svg');
                
                // Remove original elements
                ['blessing-text', 'occasion-text', 'event-type-text', 'ceremony-text'].forEach(id => {
                    const element = svgElement.querySelector(`#${id}`);
                    if (element) {
                        element.remove();
                        log(`üóëÔ∏è Removed #${id}`, 'info');
                    }
                });
                
                // Create group and inject SVG content
                const groupElement = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                groupElement.setAttribute('id', 'wedding-title-replacement');
                groupElement.setAttribute('transform', 'translate(900, 220)');
                
                Array.from(fetchedSvg.children).forEach(child => {
                    groupElement.appendChild(child.cloneNode(true));
                });
                
                svgElement.appendChild(groupElement);
                log(`‚úÖ SVG replacement complete! Injected ${fetchedSvg.children.length} child elements`, 'success');
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function replaceCongrat() {
            replaceWithSVG('/weddigTitles/congrat.svg', 'congrat.svg');
        }
        
        function replaceNikkah() {
            replaceWithSVG('/weddigTitles/Nikkah.svg', 'Nikkah.svg');
        }
        
        function restoreOriginal() {
            try {
                const svgElement = document.querySelector('#svg-container svg');
                const replacementGroup = svgElement.querySelector('#wedding-title-replacement');
                if (replacementGroup) {
                    replacementGroup.remove();
                    log('üóëÔ∏è Removed replacement group', 'info');
                }
                
                originalElements.forEach((data, id) => {
                    if (data.parent) {
                        data.parent.appendChild(data.element.cloneNode(true));
                        log(`‚úÖ Restored #${id}`, 'success');
                    }
                });
                
                log('üîÑ Original text elements restored', 'success');
            } catch (error) {
                log(`‚ùå Error restoring: ${error.message}`, 'error');
            }
        }
        
        // Auto-load template on page load
        window.addEventListener('load', () => {
            log('üöÄ Test page loaded', 'info');
            log('‚ö†Ô∏è Click "1. Load Template" to start', 'info');
        });
    </script>
</body>
</html>
