<!DOCTYPE html>
<html>
<head>
    <title>Signature Debug</title>
</head>
<body>
    <h1>Signature Storage Debug</h1>
    <pre id="debug-output"></pre>
    <script>
        function debugSignatureStorage() {
            const debugOutput = document.getElementById('debug-output');
            let output = 'SIGNATURE STORAGE DEBUG\n';
            output += '========================\n\n';
            
            // Check all localStorage keys
            const allKeys = Object.keys(localStorage);
            const signatureKeys = allKeys.filter(key => key.includes('signature'));
            
            output += `Total localStorage keys: ${allKeys.length}\n`;
            output += `Signature-related keys: ${signatureKeys.length}\n\n`;
            
            if (signatureKeys.length === 0) {
                output += 'No signature keys found!\n\n';
            } else {
                signatureKeys.forEach((key, index) => {
                    output += `${index + 1}. Key: "${key}"\n`;
                    try {
                        const value = localStorage.getItem(key);
                        if (value) {
                            const parsed = JSON.parse(value);
                            if (Array.isArray(parsed)) {
                                output += `   Type: Array\n`;
                                output += `   Count: ${parsed.length}\n`;
                                parsed.forEach((item, i) => {
                                    output += `   ${i + 1}. ${item.name || item.id || 'Unknown'}\n`;
                                });
                            } else {
                                output += `   Type: Object\n`;
                                output += `   Content: ${JSON.stringify(parsed, null, 2).substring(0, 100)}...\n`;
                            }
                        } else {
                            output += `   Value: null/empty\n`;
                        }
                    } catch (e) {
                        output += `   Error parsing: ${e.message}\n`;
                    }
                    output += '\n';
                });
            }
            
            // Check specifically for Main Branch signatures
            const mainBranchKey = 'signatures_Main Branch';
            output += `MAIN BRANCH SIGNATURES (${mainBranchKey}):\n`;
            output += '===========================================\n';
            const mainBranchData = localStorage.getItem(mainBranchKey);
            if (mainBranchData) {
                try {
                    const parsed = JSON.parse(mainBranchData);
                    output += `Count: ${parsed.length}\n`;
                    parsed.forEach((sig, i) => {
                        output += `${i + 1}. Name: ${sig.name}\n`;
                        output += `   ID: ${sig.id}\n`;
                        output += `   Primary: ${sig.isPrimary || false}\n`;
                        output += `   DataURL length: ${sig.dataURL ? sig.dataURL.length : 0}\n\n`;
                    });
                } catch (e) {
                    output += `Error: ${e.message}\n`;
                }
            } else {
                output += 'No data found!\n';
            }
            
            debugOutput.textContent = output;
        }
        
        // Run debug when page loads
        debugSignatureStorage();
    </script>
</body>
</html>